#!/bin/busybox sh

#
# Hook into the upgrade process.
#

busybox rm "$@"
error=$?

if [ "$1" == "/mnt/onboard/.kobo/KoboRoot.tgz" ]
then
(
    mkdir /mnt/onboard/.hyph
    cd /usr/local/Kobo/hyphenDicts/ || exit

    for dic in *.dic
    do
        if [ -L "$dic" ]
        then
            continue;
        fi

        mv -n "$dic" /mnt/onboard/.hyph/
    done

    for dic in /mnt/onboard/.hyph/*.dic
    do
        ln -s "$dic"
    done
)

    # Remove this hook.
    busybox rm /bin/rm ; ln -s busybox /bin/rm ; sync
fi

exit $error
